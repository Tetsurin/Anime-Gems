<div class="main-carousel-container">
	
	<div class="slides">
		<div class = "slide">
			<%= image_tag "data:image/jpg;base64,#{Base64.encode64(@animes[0].background_poster).html_safe}", :class => "slide_img active" %>
			<div class = "overlay">
				<div class = "logo-wrapper">
					<%= image_tag "data:image/jpg;base64,#{Base64.encode64(@animes[0].logo).html_safe}", :class => "slider-logo stop-slider" %> 
				</div>
				<div class = "description-wrapper", style = "display: none"> 			
					<p class = "slider-description stop-slider">
							<%=@animes[0].description%>
					</p>
				</div>
			</div>
		</div>  
		
		<div class = "slide">
			<%= image_tag "data:image/jpg;base64,#{Base64.encode64(@animes[2].background_poster).html_safe}", :class => "slide_img" %>
			<div class = "overlay">		
				<div class = "logo-wrapper", style = "display: none">
					<%= image_tag "data:image/jpg;base64,#{Base64.encode64(@animes[2].logo).html_safe}", :class => "slider-logo stop-slider"%> 
				</div>
				<div class = "description-wrapper", style = "display: none">
					<p class = "slider-description stop-slider">
						<%=@animes[2].description%>
					</p>		
				</div>
			</div>
		</div>
		
		<div class = "slide">
			<%= image_tag "data:image/jpg;base64,#{Base64.encode64(@animes[7].background_poster).html_safe}", :class => "slide_img"%>
			<div class = "overlay">	
				<div class = "logo-wrapper ", style = "display: none">
					<%= image_tag "data:image/jpg;base64,#{Base64.encode64(@animes[7].logo).html_safe}", :class => "slider-logo stop-slider" %>
				</div>
				<div class = "description-wrapper", style = "display: none">
					<p class = "slider-description stop-slider">
						<%=@animes[7].description%>
					</p>
				</div>
			</div>
		</div>
		
		<div class = "slide">
			<%= image_tag "data:image/jpg;base64,#{Base64.encode64(@animes[3].background_poster).html_safe}", :class => "slide_img"%>
			<div class = "overlay overlay-gradient">
				<div class = "logo-wrapper", style = "display: none">
					<%= image_tag "data:image/jpg;base64,#{Base64.encode64(@animes[3].logo).html_safe}", :class => "slider-logo stop-slider"%>
				</div>
				<div class = "description-wrapper", style = "display: none">
					<p class = "slider-description stop-slider">
						<%=@animes[3].description%>
					</p>
				</div>  
			</div>
		</div>

		<div class = "slide">
			<%= image_tag "data:image/jpg;base64,#{Base64.encode64(@animes[11].background_poster).html_safe}", :class => "slide_img"%>
			<div class = "overlay">
				<div class = "logo-wrapper", style = "display: none">
					<%= image_tag "data:image/jpg;base64,#{Base64.encode64(@animes[11].logo).html_safe}", :class => "slider-logo stop-slider"%>
				</div>
				<div class = "description-wrapper", style = "display: none">
					<p class = "slider-description stop-slider">
						<%=@animes[11].description%>
					</p>
				</div>
			</div>
		</div>
      
      
	</div>

    <div class="main-carousel-lines-container stop-slider">
		
		<div class = "main-carousel-lines-wrapper ">
			<div class="main-carousel-lines active" attr='0' onclick="switchImage(this)"></div>
		</div>
			
		<div class = "main-carousel-lines-wrapper">
			<div class="main-carousel-lines" attr='1' onclick="switchImage(this)"></div>
		</div>  
		
		<div class = "main-carousel-lines-wrapper">
			<div class="main-carousel-lines" attr='2' onclick="switchImage(this)"></div>
		</div>		
		
		<div class = "main-carousel-lines-wrapper">  
			<div class="main-carousel-lines" attr='3' onclick="switchImage(this)"></div>
		</div>
		
		<div class = "main-carousel-lines-wrapper">
			<div class="main-carousel-lines" attr='4' onclick="switchImage(this)"></div>
		</div>

	</div>

	<div class="slide-buttons stop-slider">
		<span class="next stop-sliding">&#10095;</span>
		<span class="prev stop-sliding">&#10094;</span>
	</div>

	
</div>

<script type="text/javascript">
	
	// Access the Images
	let slideImages = document.querySelectorAll('.slide_img');
	let slideOverlays = document.querySelectorAll('.overlay'); 
	let slideDescriptions = document.querySelectorAll('.description-wrapper');
	let slideLogos = document.querySelectorAll('.logo-wrapper');
	// Access the next and prev buttons
	let next = document.querySelector('.next');
	let prev = document.querySelector('.prev');
	// Access the indicators
	let mainCarouselLines = document.querySelectorAll('.main-carousel-lines');
	

	var counter = 0;
	slideDescriptions[counter].style.display = "";

	function playProgressBarAnimation() {
    	const activeProgressBar = document.querySelector(".main-carousel-lines-wrapper .active");
    	if (activeProgressBar) {
        	activeProgressBar.style.animation = 'progressBar 5000ms linear forwards';
        	activeProgressBar.style.background = '#00d873';
    	}
	}

	
	// Code for next button
	next.addEventListener('click', slideNext);
	function slideNext(){
		slideLogos[counter].style.display = "";
		slideImages[counter].style.animation = 'next1 0.5s ease-in forwards';
		slideOverlays[counter].style.animation = 'next1 0.5s ease-in forwards';

		if(counter >= slideImages.length-1){
			counter = 0;
			slideLogos[counter].style.display = "";
		}
		else{
			
			counter++;
			slideDescriptions[counter].style.display = "";
			slideLogos[counter].style.display = "";
		}
		slideImages[counter].style.animation = 'next2 0.5s ease-in forwards';
		slideOverlays[counter].style.animation = 'next2 0.5s ease-in forwards';
		indicators();

	}

	// Code for prev button
	prev.addEventListener('click', slidePrev);
	function slidePrev(){
		slideImages[counter].style.animation = 'prev1 0.5s ease-in forwards';
		slideOverlays[counter].style.animation = 'prev1 0.5s ease-in forwards';
		if(counter == 0){
			counter = slideImages.length-1;
			slideDescriptions[counter].style.display = "";
			slideLogos[counter].style.display = "";
		}
		else{
			
			counter--;
			slideDescriptions[counter].style.display = "";
			slideLogos[counter].style.display = "";

		}
		slideImages[counter].style.animation = 'prev2 0.5s ease-in forwards';
		slideOverlays[counter].style.animation = 'prev2 0.5s ease-in forwards';
		indicators();
	}

	// Auto slideing
	function autoSliding(){
		
		deletInterval = setInterval(timer, 5000);
		function timer(){
			console.log("timer");
			slideNext();
			indicators();
		}
	}
	
	autoSliding();

	// Stop auto sliding when mouse is over
	let slideStoppers = document.querySelectorAll(".stop-slider");

	slideStoppers.forEach(function(elem) {
   		elem.addEventListener("mouseover", function() {
        	clearInterval(deletInterval);
			document.querySelector(".main-carousel-lines-wrapper .active").style.animationPlayState = "paused";
			console.log("hovered");
   	 	});
	});
	
	// Resume sliding when mouse is out
	slideStoppers.forEach(function(elem) {
    	elem.addEventListener('mouseout', function() {
        	autoSliding(); // Відновлюємо автослайдинг
        	document.querySelector(".main-carousel-lines-wrapper .active").style.animationPlayState = "running"; // Відтворюємо анімацію
    	});
	});

	// Add and remove active class from the indicators
	function indicators(){
		for(i = 0; i < mainCarouselLines.length; i++){
			mainCarouselLines[i].className = mainCarouselLines[i].className.replace(' active', '');
		}
		mainCarouselLines[counter].className += ' active';
	}

	// Add click event to the indicator
	function switchImage(currentImage){
		currentImage.classList.add('active');
		var imageId = currentImage.getAttribute('attr');
		if(imageId > counter){
		slideImages[counter].style.animation = 'next1 0.5s ease-in forwards';
		slideOverlays[counter].style.animation = 'next1 0.5s ease-in forwards';
		slideDescriptions[counter].style.display = "";
		slideLogos[counter].style.display = "";
		counter = imageId;
		slideImages[counter].style.animation = 'next2 0.5s ease-in forwards';
		slideOverlays[counter].style.animation = 'next2 0.5s ease-in forwards';
		slideDescriptions[counter].style.display = "";
		slideLogos[counter].style.display = ""; 	
		}
		else if(imageId == counter){
			return;
		}
		else{
		slideImages[counter].style.animation = 'prev1 0.5s ease-in forwards';
		slideOverlays[counter].style.animation = 'prev1 0.5s ease-in forwards';
		slideDescriptions[counter].style.display = "";
		slideLogos[counter].style.display = "";
		counter = imageId;
		slideImages[counter].style.animation = 'prev2 0.5s ease-in forwards';
		slideOverlays[counter].style.animation = 'prev2 0.5s ease-in forwards';	
		slideDescriptions[counter].style.display = "";
		slideLogos[counter].style.display = "";
		}
		indicators();
	}
</script>